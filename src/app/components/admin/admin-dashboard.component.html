<!-- Main Content -->
<div class="mx-auto py-3 sm:px-6 lg:px-8">
  <!-- Error Messages -->
  <div
    *ngIf="error"
    class="mb-4 bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-md"
  >
    {{ error }}
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="bg-white shadow rounded-lg">
    <div class="px-4 py-5 sm:p-6 text-center">
      <div
        class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"
      ></div>
      <!-- Header and Navigation moved to AdminLayout -->
    </div>
  </div>

  <!-- Dashboard Layout -->
  <div *ngIf="!loading" class="space-y-6">
    <!-- Quick Actions - Top Row -->
    <div class="bg-white shadow rounded-lg">
      <div class="px-4 py-3 sm:p-6">
        <h3 class="text-lg leading-3 font-medium text-gray-900 mb-4">
          Acciones Rápidas
        </h3>
        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-2">
          <button
            routerLink="/admin/users"
            class="bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-center transition-colors"
          >
            <fa-icon
              [icon]="faUserFriends"
              class="h-5 w-5 mx-auto mb-1"
            ></fa-icon>
            <div class="text-sm font-medium">Gestionar Usuarios</div>
          </button>

          <button
            routerLink="/admin/spaces"
            class="bg-green-600 hover:bg-green-700 text-white rounded-lg text-center transition-colors"
          >
            <fa-icon [icon]="faHospital" class="h-5 w-5 mx-auto mb-1"></fa-icon>
            <div class="text-sm font-medium">Gestionar Espacios</div>
          </button>

          <button
            routerLink="/admin/reservations"
            class="bg-purple-600 hover:bg-purple-700 text-white rounded-lg text-center transition-colors"
          >
            <fa-icon
              [icon]="faClipboardList"
              class="h-5 w-5 mx-auto mb-1"
            ></fa-icon>
            <div class="text-sm font-medium">Aprobar Reservaciones</div>
          </button>

          <button
            routerLink="/admin/calendar"
            class="bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-center transition-colors"
          >
            <fa-icon
              [icon]="faCalendarAlt"
              class="h-5 w-5 mx-auto mb-1"
            ></fa-icon>
            <div class="text-sm font-medium">Ver Calendario</div>
          </button>

          <button
            routerLink="/admin/business-hours"
            class="bg-orange-600 hover:bg-orange-700 text-white p-2 rounded-lg text-center transition-colors md:col-span-1"
          >
            <fa-icon [icon]="faCog" class="h-6 w-6 mx-auto mb-2"></fa-icon>
            <div class="text-sm font-medium">Horarios</div>
          </button>
        </div>
      </div>
    </div>

    <!-- Collapsible Statistics Card -->
    <div class="bg-white shadow rounded-lg">
      <div class="px-4 py-3 sm:p-6">
        <button
          (click)="toggleStatistics()"
          class="w-full flex items-center justify-between text-left"
        >
          <h3 class="text-lg font-medium text-gray-900">
            Estadísticas Semanales
          </h3>
          <fa-icon
            [icon]="statisticsExpanded ? faChevronUp : faChevronDown"
            class="h-5 w-5 text-gray-400 transition-transform"
          >
          </fa-icon>
        </button>

        <!-- Statistics Content -->
        <div *ngIf="statisticsExpanded" class="mt-6 space-y-6">
          <!-- Weekly Hours Stats -->
          <div>
            <h4 class="text-md font-semibold text-gray-900 mb-4">Estadísticas de Horas (Semanal)</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
              <div class="flex items-center p-3 bg-blue-50 rounded-lg">
                <div class="flex-shrink-0 mr-3"><fa-icon [icon]="faCalendarWeek" class="h-5 w-5 text-blue-400"></fa-icon></div>
                <div class="min-w-0 flex-1">
                  <p class="text-xs font-medium text-gray-900 leading-tight">Horas Potenciales</p>
                  <p class="text-sm font-semibold text-blue-600">{{ stats.weekly_hours_potential | number : "1.0-0" }}</p>
                </div>
              </div>
              <div class="flex items-center p-3 bg-orange-50 rounded-lg">
                <div class="flex-shrink-0 mr-3"><fa-icon [icon]="faClock" class="h-5 w-5 text-orange-400"></fa-icon></div>
                <div class="min-w-0 flex-1">
                  <p class="text-xs font-medium text-gray-900 leading-tight">Horas Reservadas</p>
                  <p class="text-sm font-semibold text-orange-600">{{ stats.weekly_hours_reserved | number : "1.0-0" }}</p>
                </div>
              </div>
              <div class="flex items-center p-3 bg-green-50 rounded-lg">
                <div class="flex-shrink-0 mr-3"><fa-icon [icon]="faCheckCircle" class="h-5 w-5 text-green-400"></fa-icon></div>
                <div class="min-w-0 flex-1">
                  <p class="text-xs font-medium text-gray-900 leading-tight">Horas Disponibles</p>
                  <p class="text-sm font-semibold text-green-600">{{ stats.weekly_hours_available | number : "1.0-0" }}</p>
                </div>
              </div>
              <div class="flex items-center p-3 bg-purple-50 rounded-lg">
                <div class="flex-shrink-0 mr-3"><fa-icon [icon]="faClipboardList" class="h-5 w-5 text-purple-400"></fa-icon></div>
                <div class="min-w-0 flex-1">
                  <p class="text-xs font-medium text-gray-900 leading-tight">Total Reservaciones</p>
                  <p class="text-sm font-semibold text-purple-600">{{ stats.weekly_reservations_count }}</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Weekly Reservations & Operations -->
          <div>
            <h4 class="text-md font-semibold text-gray-900 mb-4">Operaciones Semanales</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
              <div class="flex items-center p-3 bg-indigo-50 rounded-lg">
                <div class="flex-shrink-0 mr-3"><fa-icon [icon]="faUserCheck" class="h-5 w-5 text-indigo-400"></fa-icon></div>
                <div class="min-w-0 flex-1">
                  <p class="text-xs font-medium text-gray-900 leading-tight">Reservas Externas</p>
                  <p class="text-sm font-semibold text-indigo-600">{{ stats.weekly_external_reservations }}</p>
                </div>
              </div>
              <div class="flex items-center p-3 bg-red-50 rounded-lg">
                <div class="flex-shrink-0 mr-3"><fa-icon [icon]="faTimes" class="h-5 w-5 text-red-400"></fa-icon></div>
                <div class="min-w-0 flex-1">
                  <p class="text-xs font-medium text-gray-900 leading-tight">Cancelaciones</p>
                  <p class="text-sm font-semibold text-red-600">{{ stats.weekly_cancellations }}</p>
                </div>
              </div>
              <div class="flex items-center p-3 bg-yellow-50 rounded-lg">
                <div class="flex-shrink-0 mr-3"><fa-icon [icon]="faHourglass" class="h-5 w-5 text-yellow-400"></fa-icon></div>
                <div class="min-w-0 flex-1">
                  <p class="text-xs font-medium text-gray-900 leading-tight">Reservas Pendientes</p>
                  <p class="text-sm font-semibold text-yellow-600">{{ stats.pending_reservations_count }}</p>
                </div>
              </div>
              <div class="flex items-center p-3 bg-blue-50 rounded-lg">
                <div class="flex-shrink-0 mr-3"><fa-icon [icon]="faBuilding" class="h-5 w-5 text-blue-400"></fa-icon></div>
                <div class="min-w-0 flex-1">
                  <p class="text-xs font-medium text-gray-900 leading-tight">Total Consultorios</p>
                  <p class="text-sm font-semibold text-blue-600">{{ stats.total_active_spaces }}</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Weekly Financial Stats -->
          <div>
            <h4 class="text-md font-semibold text-gray-900 mb-4">Estadísticas Financieras (Semanal)</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
              <div class="flex items-center p-3 bg-green-50 rounded-lg">
                <div class="flex-shrink-0 mr-3"><fa-icon [icon]="faChartLine" class="h-5 w-5 text-green-400"></fa-icon></div>
                <div class="min-w-0 flex-1">
                  <p class="text-xs font-medium text-gray-900 leading-tight">Ingresos</p>
                  <p class="text-sm font-semibold text-green-600">${{ stats.weekly_income | number : "1.2-2" }}</p>
                </div>
              </div>
              <div class="flex items-center p-3 bg-blue-50 rounded-lg">
                <div class="flex-shrink-0 mr-3"><fa-icon [icon]="faCreditCard" class="h-5 w-5 text-blue-500"></fa-icon></div>
                <div class="min-w-0 flex-1">
                  <p class="text-xs font-medium text-gray-900 leading-tight">Créditos Comprados</p>
                  <p class="text-sm font-semibold text-blue-600">{{ stats.weekly_credits_purchased }}</p>
                </div>
              </div>
              <div class="flex items-center p-3 bg-purple-50 rounded-lg">
                <div class="flex-shrink-0 mr-3"><fa-icon [icon]="faMoneyBillWave" class="h-5 w-5 text-purple-400"></fa-icon></div>
                <div class="min-w-0 flex-1">
                  <p class="text-xs font-medium text-gray-900 leading-tight">Créditos Otorgados</p>
                  <p class="text-sm font-semibold text-purple-600">{{ stats.weekly_credits_granted }}</p>
                </div>
              </div>
              <div class="flex items-center p-3 bg-teal-50 rounded-lg">
                <div class="flex-shrink-0 mr-3"><fa-icon [icon]="faCoins" class="h-5 w-5 text-teal-400"></fa-icon></div>
                <div class="min-w-0 flex-1">
                  <p class="text-xs font-medium text-gray-900 leading-tight">Créditos Totales</p>
                  <p class="text-sm font-semibold text-teal-600">{{ stats.weekly_credits_total }}</p>
                </div>
              </div>
            </div>
          </div>

          <!-- General User Stats -->
          <div>
            <h4 class="text-md font-semibold text-gray-900 mb-4">Estadísticas de Usuarios</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
              <div class="flex items-center p-3 bg-blue-50 rounded-lg">
                <div class="flex-shrink-0 mr-3"><fa-icon [icon]="faUsers" class="h-6 w-6 text-blue-400"></fa-icon></div>
                <div class="min-w-0 flex-1">
                  <p class="text-xs font-medium text-gray-900 leading-tight">Usuarios Registrados</p>
                  <p class="text-lg font-semibold text-blue-600">{{ stats.total_users_registered }}</p>
                </div>
              </div>
              <div class="flex items-center p-3 bg-green-50 rounded-lg">
                <div class="flex-shrink-0 mr-3"><fa-icon [icon]="faCreditCard" class="h-6 w-6 text-green-400"></fa-icon></div>
                <div class="min-w-0 flex-1">
                  <p class="text-xs font-medium text-gray-900 leading-tight">Con Créditos Activos</p>
                  <p class="text-lg font-semibold text-green-600">{{ stats.users_with_active_credits }}</p>
                </div>
              </div>
              <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                <div class="flex-shrink-0 mr-3"><fa-icon [icon]="faUserSlash" class="h-6 w-6 text-gray-400"></fa-icon></div>
                <div class="min-w-0 flex-1">
                  <p class="text-xs font-medium text-gray-900 leading-tight">Sin Créditos</p>
                  <p class="text-lg font-semibold text-gray-600">{{ stats.users_without_credits }}</p>
                </div>
              </div>
              <div class="flex items-center p-3 bg-yellow-50 rounded-lg">
                <div class="flex-shrink-0 mr-3"><fa-icon [icon]="faClock" class="h-6 w-6 text-yellow-400"></fa-icon></div>
                <div class="min-w-0 flex-1">
                  <p class="text-xs font-medium text-gray-900 leading-tight">Créditos por Vencer (7d)</p>
                  <p class="text-sm font-semibold text-yellow-600">{{ stats.users_with_expiring_credits }}</p>
                </div>
              </div>
              <div class="flex items-center p-3 bg-red-50 rounded-lg">
                <div class="flex-shrink-0 mr-3"><fa-icon [icon]="faExclamationCircle" class="h-6 w-6 text-red-400"></fa-icon></div>
                <div class="min-w-0 flex-1">
                  <p class="text-xs font-medium text-gray-900 leading-tight">Con Créditos Vencidos</p>
                  <p class="text-sm font-semibold text-red-600">{{ stats.users_with_expired_credits }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Collapsible Pending Reservations Card -->
    <div *ngIf="pendingReservations.length > 0" class="bg-white shadow rounded-lg">
      <div class="px-4 py-3 sm:p-6">
        <button
          (click)="togglePendingReservations()"
          class="w-full flex items-center justify-between text-left"
          title="Mostrar/Ocultar reservaciones pendientes">
          <h3 class="text-lg leading-6 font-medium text-gray-900">
            Reservaciones Pendientes ({{ pendingReservations.length }})
          </h3>
          <fa-icon 
            [icon]="pendingReservationsExpanded ? faChevronUp : faChevronDown" 
            class="h-5 w-5 text-gray-400">
          </fa-icon>
        </button>
        
        <div *ngIf="pendingReservationsExpanded" class="mt-4 space-y-4">
          <div *ngFor="let r of pendingReservations" class="p-4 border rounded-lg flex items-center justify-between">
            <div>
              <p class="font-semibold">{{ r.user_name }} - {{ r.space_name }}</p>
              <p class="text-sm text-gray-600">{{ r.start_time | date:'fullDate' }} a las {{ r.start_time | date:'shortTime' }}</p>
            </div>
            <div class="flex space-x-2">
              <button (click)="approveReservation(r.id)" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded-md text-sm">Aprobar</button>
              <button (click)="cancelReservation(r.id)" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-md text-sm">Cancelar</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Collapsible Weekly Calendar Card -->
    <div class="bg-white shadow rounded-lg">
      <div class="px-4 py-3 sm:p-6">
        <button
          (click)="toggleCalendar()"
          class="w-full flex items-center justify-between text-left"
        >
          <h3 class="text-lg font-medium text-gray-900">Calendario Semanal</h3>
          <fa-icon
            [icon]="calendarExpanded ? faChevronUp : faChevronDown"
            class="h-5 w-5 text-gray-400 transition-transform"
          >
          </fa-icon>
        </button>

        <!-- Calendar Content -->
        <div *ngIf="calendarExpanded" class="mt-6">
          <app-weekly-dashboard></app-weekly-dashboard>
        </div>
      </div>
    </div>

    <!-- Recent Activity - Always visible -->
    <!--   <div class="bg-white shadow rounded-lg">
        <div class="px-4 py-5 sm:p-6">
          <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">Actividad Reciente</h3>

          <div *ngIf="recentActivity.length === 0" class="text-gray-500 text-center py-8">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
            </svg>
            <p class="mt-2">No hay actividad reciente</p>
          </div>

          <div *ngIf="recentActivity.length > 0" class="flow-root">
            <ul class="-mb-8">
              <li *ngFor="let activity of recentActivity; let last = last">
                <div class="relative pb-8" [class.pb-0]="last">
                  <span *ngIf="!last" class="absolute top-4 left-4 -ml-px h-full w-0.5 bg-gray-200"></span>
                  <div class="relative flex space-x-3">
                    <div>
                      <span class="h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center ring-8 ring-white">
                        <svg class="h-5 w-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                          <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
                        </svg>
                      </span>
                    </div>
                    <div class="min-w-0 flex-1 pt-1.5 flex justify-between space-x-4">
                      <div>
                        <p class="text-sm text-gray-500">{{ activity.description || activity.message }}</p>
                      </div>
                      <div class="text-right text-sm whitespace-nowrap text-gray-500">
                        <time>{{ activity.created_at | date:'short' }}</time>
                      </div>
                    </div>
                  </div>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </div> -->

    <!-- Space Stats -->
   
  </div>
</div>
