<div class="min-h-screen bg-gray-50">
  <!-- Header -->
  <div class="bg-white shadow">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
      <h1 class="text-2xl font-bold text-gray-900">Gestión de Créditos</h1>
    </div>
  </div>

  <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
    <!-- Success/Error Messages -->
    <div *ngIf="success" class="mb-4 bg-green-50 border border-green-200 text-green-600 px-4 py-3 rounded-md">
      {{ success }}
    </div>
    
    <div *ngIf="error" class="mb-4 bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-md">
      {{ error }}
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Add Credits Form -->
      <div class="bg-white shadow rounded-lg">
        <div class="px-4 py-5 sm:p-6">
          <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">Agregar Créditos</h3>
          
          <form [formGroup]="creditsForm" (ngSubmit)="onSubmit()" class="space-y-4">
            <div>
              <label for="user_id" class="block text-sm font-medium text-gray-700">Seleccionar Profesional</label>
              <select 
                id="user_id" 
                formControlName="user_id"
                class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                [class.border-red-500]="user_id?.invalid && user_id?.touched">
                <option value="">Selecciona un profesional</option>
                <option *ngFor="let user of users" [value]="user.id">
                  {{ user.name }} - {{ user.specialty }}
                </option>
              </select>
              <div *ngIf="user_id?.invalid && user_id?.touched" class="text-red-600 text-sm mt-1">
                Selecciona un profesional
              </div>
            </div>

            <div>
              <label for="amount" class="block text-sm font-medium text-gray-700">Cantidad de Créditos</label>
              <input 
                type="number" 
                id="amount" 
                formControlName="amount"
                min="1"
                step="1"
                class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                [class.border-red-500]="amount?.invalid && amount?.touched">
              <div *ngIf="amount?.invalid && amount?.touched" class="text-red-600 text-sm mt-1">
                <div *ngIf="amount?.errors?.['required']">La cantidad es requerida</div>
                <div *ngIf="amount?.errors?.['min']">Mínimo 1 crédito</div>
              </div>
              <p class="mt-1 text-sm text-gray-500">
                Nota: 6 créditos = 1 hora de consultorio (60-100 pesos)
              </p>
            </div>

            <!-- Selected User Info -->
            <div *ngIf="getSelectedUser()" class="bg-blue-50 p-4 rounded-md">
              <h4 class="text-sm font-medium text-blue-900">Usuario Seleccionado:</h4>
              <p class="text-sm text-blue-700">{{ getSelectedUser()?.name }}</p>
              <p class="text-sm text-blue-600">Créditos actuales: {{ getSelectedUser()?.active_credits || 0 }}</p>
            </div>

            <button 
              type="submit" 
              [disabled]="creditsForm.invalid || loading"
              class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium disabled:opacity-50">
              {{ loading ? 'Agregando...' : 'Agregar Créditos' }}
            </button>
          </form>
        </div>
      </div>

      <!-- Credits Info -->
      <div class="bg-white shadow rounded-lg">
        <div class="px-4 py-5 sm:p-6">
          <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">Información de Créditos</h3>
          
          <div class="space-y-4">
            <div class="bg-gray-50 p-4 rounded-md">
              <h4 class="text-sm font-medium text-gray-900">Sistema de Créditos</h4>
              <ul class="mt-2 text-sm text-gray-600 space-y-1">
                <li>• 6 créditos = 1 hora de consultorio</li>
                <li>• Costo por hora: 60-100 pesos</li>
                <li>• Penalización por cancelación: 2 créditos (30-60 pesos)</li>
                <li>• Vigencia: 30 días desde la asignación</li>
              </ul>
            </div>

            <div class="bg-yellow-50 p-4 rounded-md">
              <h4 class="text-sm font-medium text-yellow-900">Reglas de Cancelación</h4>
              <ul class="mt-2 text-sm text-yellow-700 space-y-1">
                <li>• Cancelación +24h: Sin penalización</li>
                <li>• Cancelación -24h: Penalización de 2 créditos</li>
                <li>• Usuario bloqueado hasta pagar penalización</li>
              </ul>
            </div>

            <div class="bg-green-50 p-4 rounded-md">
              <h4 class="text-sm font-medium text-green-900">Paquetes Sugeridos</h4>
              <ul class="mt-2 text-sm text-green-700 space-y-1">
                <li>• Paquete Básico: 12 créditos (2 horas)</li>
                <li>• Paquete Estándar: 30 créditos (5 horas)</li>
                <li>• Paquete Premium: 60 créditos (10 horas)</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Users Credits Overview -->
    <div class="mt-6 bg-white shadow rounded-lg">
      <div class="px-4 py-5 sm:p-6">
        <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">Resumen de Créditos por Usuario</h3>
        
        <div *ngIf="users.length === 0" class="text-center py-8 text-gray-500">
          <p>No hay profesionales registrados</p>
        </div>

        <div *ngIf="users.length > 0" class="overflow-hidden shadow ring-1 ring-black ring-opacity-5 md:rounded-lg">
          <table class="min-w-full divide-y divide-gray-300">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Profesional</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Especialidad</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Créditos</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Horas Disponibles</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <tr *ngFor="let user of users" class="hover:bg-gray-50">
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="flex items-center">
                    <div class="h-8 w-8 flex-shrink-0">
                      <div class="h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center">
                        <span class="text-xs font-medium text-blue-600">{{ user.name.charAt(0).toUpperCase() }}</span>
                      </div>
                    </div>
                    <div class="ml-3">
                      <div class="text-sm font-medium text-gray-900">{{ user.name }}</div>
                      <div class="text-sm text-gray-500">{{ user.email }}</div>
                    </div>
                  </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                  {{ user.specialty }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
                        [class.bg-green-100]="(user.active_credits || 0) >= 6"
                        [class.text-green-800]="(user.active_credits || 0) >= 6"
                        [class.bg-red-100]="(user.active_credits || 0) < 6"
                        [class.text-red-800]="(user.active_credits || 0) < 6">
                    {{ user.active_credits || 0 }}
                  </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                  {{ ((user.active_credits || 0) / 6) | number:'1.1-1' }}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
